"use client";
import{_ as e}from"@swc/helpers/_/_extends";import{_ as n}from"@swc/helpers/_/_object_without_properties_loose";import{jsx as i,jsxs as s}from"react/jsx-runtime";import{ChevronUpDownIcon as l}from"@heroicons/react/24/outline";import{classNames as r,PopoverTrigger as t,mergeRefs as a,eventHandler as o,Button as c,Popover as d,PopoverContent as h,Command as m,CommandInput as p,CommandList as u,CommandEmpty as f,CommandLoading as g,Spinner as y,CommandItem as x,CommandGroup as v}from"@rafty/ui";import{forwardRef as N,useRef as b,useState as C,useEffect as S,useReducer as w}from"react";import{useComboboxContext as L,ComboboxProvider as O}from"./context.esm.js";import{InternalOptionsRender as R}from"./internals/InternalOptionsRender.esm.js";import{InternalTriggerRender as j}from"./internals/InternalTriggerRender.esm.js";function D(e){var{isDisabled:s=!1,isInvalid:l=!1,isLoading:r=!1,isReadOnly:t=!1,placeholder:a,id:o,options:c=[],children:h}=e,m=n(e,["isDisabled","isInvalid","isLoading","isReadOnly","placeholder","id","options","children"]);const p=b(null),[u,f]=C(!1),g=m.selected?Array.isArray(m.selected)?m.selected:[m.selected]:[],y="multi"===m.type;S((()=>{(s||r||t)&&f(!1)}),[s,r,t]);const[x,v]=w(((e,n)=>{const i=e.findIndex((e=>e===n)),s=-1!==i;let l;if(n)if(y)if(s){const n=[...e];n.splice(i,1),l=n}else l=[...e,n];else l=s?[]:[n];else l=[];return y||f(!1),l}),g);return S((()=>{y?null==m.onSelectionChange||m.onSelectionChange.call(m,x):null==m.onSelectionChange||m.onSelectionChange.call(m,x.length>0?x[0]:void 0)}),[x]),i(O,{value:{id:o,type:m.type,options:c,placeholder:a,isDisabled:s,isLoading:r,isInvalid:l,isReadOnly:t,isOpen:u,setOpen:f,selected:x,onSelectionChange:v,triggerRef:p},children:i(d,{open:u,onOpenChange:f,children:h})})}const I=N((function(s,o){var{isDisabled:c,isLoading:d,className:h,variant:m="outline",role:p="combobox",rightIcon:u,children:f=i(j,{})}=s,g=n(s,["isDisabled","isLoading","className","variant","role","rightIcon","children"]);const{id:y,isOpen:x,isDisabled:v,isLoading:N,isReadOnly:b,triggerRef:C}=L(),S=c||v||b,w=d||N,O=null!=u?u:i(l,{className:r("size-3.5 shrink-0 stroke-2",x?"text-primary-500 dark:text-primary-400":"text-secondary-500 dark:text-secondary-400")});return i(t,e({id:y},g,{variant:m,role:p,rightIcon:O,className:r("w-full justify-between text-start font-medium",h),isDisabled:S,isLoading:w,ref:a(o,C),children:i("span",{className:"flex-1",children:f})}))}));function k(l){var{className:t,style:a,children:o=R,showSearch:c=!0,shouldFilter:d,search:x,onSearchChange:v,isLoading:N}=l,b=n(l,["className","style","children","showSearch","shouldFilter","search","onSearchChange","isLoading"]);const{placeholder:w,triggerRef:O,options:j}=L(),[D,I]=C(0);return S((()=>{var e,n;I(null!=(n=null==(e=O.current)?void 0:e.offsetWidth)?n:0)}),[O]),i(h,e({},b,{className:r("max-w-none p-0",t),style:e({width:D},a),children:s(m,{shouldFilter:d,children:[c&&i(p,{placeholder:null==w?void 0:w.search,value:x,onValueChange:v}),s(u,{className:"p-1",children:[0===j.length?i("div",{className:"text-secondary-500 dark:text-secondary-400 flex h-10 select-none items-center justify-center py-0 empty:hidden",children:"No data available"}):j.map(((e,n)=>i(o,{option:e,index:n},`${n}-${e.value}`))),!N&&s(f,{className:"text-secondary-500 dark:text-secondary-400 flex h-10 select-none items-center justify-center py-0 empty:hidden",children:["No results found ",x&&`for "${x}".`]}),N&&i(g,{progress:50,children:s("span",{className:"text-secondary-500 dark:text-secondary-400 flex h-10 w-full select-none items-center justify-center gap-2 text-sm font-medium",children:[i(y,{size:"sm"})," Loading..."]})})]})]})}))}const _=x,z=v,A=N((function(s,l){var{children:t,size:a="sm",variant:d="ghost",colorScheme:h="error",className:m}=s,p=n(s,["children","size","variant","colorScheme","className"]);const{type:u,selected:f,onSelectionChange:g,isDisabled:y,isLoading:x,isReadOnly:v}=L();if(0===f.length||y||v||x)return;let N="Clear";"multi"===u&&(N="Clear All");const b=o((()=>g(null)));return i(c,e({},p,{size:a,variant:d,colorScheme:h,onClick:b,onKeyDown:b,className:r("font-medium",m),ref:l,children:null!=t?t:N}))}));export{D as Combobox,A as ComboboxClearButton,k as ComboboxContent,_ as ComboboxItem,z as ComboboxItemsGroup,I as ComboboxTrigger};
